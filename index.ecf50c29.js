function e(e,t,i,o){Object.defineProperty(e,t,{get:i,set:o,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},o={},s=t.parcelRequiree4df;null==s&&((s=function(e){if(e in i)return i[e].exports;if(e in o){var t=o[e];delete o[e];var s={id:e,exports:{}};return i[e]=s,t.call(s.exports,s,s.exports),s.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){o[e]=t},t.parcelRequiree4df=s),s.register("27Lyk",(function(t,i){var o,s;e(t.exports,"register",(()=>o),(e=>o=e)),e(t.exports,"resolve",(()=>s),(e=>s=e));var n={};o=function(e){for(var t=Object.keys(e),i=0;i<t.length;i++)n[t[i]]=e[t[i]]},s=function(e){var t=n[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),s("27Lyk").register(JSON.parse('{"aT88m":"index.ecf50c29.js","hFnwJ":"pop.3317084d.m4a","1Zl8G":"swipe.e2fb1dc6.m4a"}'));class n{constructor(e,t){this.x=e,this.y=t}static areSiblings(e,t){return(e.x===t.x||e.y===t.y)&&(Math.abs(e.x-t.x)<=1&&Math.abs(e.y-t.y)<=1)}}let l;!function(e){e.Beacon="beacon",e.Candy="candy",e.Chocolate="chocolate",e.Dice="dice",e.Lollypop="lollypop",e.Poop="poop"}(l||(l={}));class r{eventListeners=new Map;constructor(){const e=this;return new Proxy(e,{set:(t,i,o,s)=>(e.notify(i,o),Reflect.set(t,i,o,s))})}subscribe(e,t){this.eventListeners.has(e)?this.eventListeners.get(e)?.push(t):this.eventListeners.set(e,[t])}notify(e,t){this.eventListeners.get(e)?.forEach((e=>e(t)))}}class a extends r{constructor(e,t){super(),this.position=e,this.icon=t}}[[l.Beacon,l.Dice,l.Poop,l.Dice,l.Lollypop,l.Beacon,l.Chocolate,l.Dice],[l.Lollypop,l.Chocolate,l.Poop,l.Dice,l.Candy,l.Candy,l.Lollypop,l.Candy],[l.Chocolate,l.Poop,l.Beacon,l.Beacon,l.Dice,l.Dice,l.Beacon,l.Lollypop],[l.Dice,l.Lollypop,l.Chocolate,l.Candy,l.Chocolate,l.Poop,l.Candy,l.Poop],[l.Candy,l.Dice,l.Lollypop,l.Chocolate,l.Lollypop,l.Beacon,l.Dice,l.Lollypop],[l.Dice,l.Candy,l.Dice,l.Beacon,l.Dice,l.Poop,l.Candy,l.Poop],[l.Poop,l.Beacon,l.Poop,l.Dice,l.Chocolate,l.Lollypop,l.Dice,l.Chocolate],[l.Candy,l.Chocolate,l.Candy,l.Lollypop,l.Beacon,l.Chocolate,l.Beacon,l.Lollypop]].flat();class c extends r{constructor(e=8){super(),this.size=e,this.score=0,this.tiles=[]}generate(){this.tiles=[],this.score=0;for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){const i=new n(e,t);this.tiles.push(new a(i,this.getIcon(i)))}this.notify("tiles",this.tiles)}findByPosition(e,t){return this.tiles[e*this.size+t]}findVerticalLine(e){const t=[];for(let i=0;i<this.size;i++){const o=this.findByPosition(e,i);o&&t.push(o)}return t}findHorizontalLine(e){const t=[];for(let i=0;i<this.size;i++){const o=this.findByPosition(i,e);o&&t.push(o)}return t}swapTiles(e,t){const i=this.tiles.indexOf(e),o=this.tiles.indexOf(t);if(i<0||o<0)return;const s=e.position;e.position=t.position,t.position=s,this.tiles[i]=t,this.tiles[o]=e}resolveMatches(){for(let e=0;e<this.size;e++)[...c.findClusters(this.findVerticalLine(e)),...c.findClusters(this.findHorizontalLine(e))].filter((e=>e.length>=3)).flat().forEach((e=>e.icon=null))}hasMatches(){for(let e=0;e<this.size;e++){if([...c.findClusters(this.findVerticalLine(e)),...c.findClusters(this.findHorizontalLine(e))].filter((e=>e.length>=3)).length>0)return!0}return!1}shiftItems(){for(let e=0;e<this.size;e++){const t=this.findVerticalLine(e);for(let e=t.length-1;e>=0;e--)for(let i=e-1;i>=0;i--){const o=t[e],s=t[i];(o.icon||s.icon)&&(!o.icon&&s.icon&&(this.swapTiles(o,s),t[e]=s,t[i]=o))}}this.tiles.forEach((e=>{e.icon||(e.position=new n(e.position.x,e.position.y-this.size))}))}calculateScore(e){console.log(e),this.tiles.forEach((t=>{t.icon||(this.score+=100*e)}))}fillUp(){this.tiles.forEach((e=>{if(e.icon)return;const t=new n(e.position.x,e.position.y+this.size);e.position=t,e.icon=this.getIcon(t)}))}getIcon({x:e,y:t}){let i=[l.Beacon,l.Candy,l.Chocolate,l.Dice,l.Lollypop,l.Poop];const o=this.findByPosition(e,t-1),s=this.findByPosition(e-1,t);return i=i.filter((e=>![s?.icon,o?.icon].includes(e))),i[Math.floor(Math.random()*i.length)]}static areSwappable(e,t){return e.icon!==t.icon&&(!(!e.icon||!t.icon)&&!!n.areSiblings(e.position,t.position))}static findClusters(e){const t=[];let i=[];for(let o=0;o<e.length;o++){const s=e[o];i.length?i[0].icon!==s.icon?(t.push(i),i=[s]):i.push(s):i.push(s)}return t.push(i),t}toMatrix(){const e=[];for(let t=0;t<this.size;t++){const i=[];for(let e=0;e<this.size;e++)i.push(this.findByPosition(e,t)?.icon);e.push(i)}return e}}const h=e=>new Promise((t=>{setTimeout(t,e)}));var p;p=new URL(s("27Lyk").resolve("hFnwJ"),import.meta.url).toString();var d;d=new URL(s("27Lyk").resolve("1Zl8G"),import.meta.url).toString();const f=new Map([["pop",new URL(p)],["swipe",new URL(d)]]),u=(e,t={})=>{const i=new Audio(f.get(e)?.toString());return Object.keys(t).forEach((e=>{i[e]=t[e]||i[e]})),i},y=u("pop",{volume:.07}),w=u("swipe",{volume:.07}),m=document.getElementById("field"),g=document.getElementById("score"),L=document.getElementById("time"),v=document.getElementById("multiplier"),b=new KeyframeEffect(v,[{opacity:1},{transform:"scale(1.5)"},{opacity:0}],{duration:500,direction:"normal",easing:"ease-in-out",fill:"forwards"}),C=new Animation(b,document.timeline);function x(e,t){e.style.top=`${t.y}em`,e.style.left=`${t.x}em`}const B=new c(8),P=new class extends r{constructor(e){super(),this.seconds=e,this.time=e}add(e){this.time+=e}start(){this.interval||(this.interval=setInterval((()=>{0!==this.time?this.time--:this.stop()}),1e3))}stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}reset(){this.time=this.seconds}}(15);let D=null;B.subscribe("tiles",(e=>{if(!m)return;m.style.width=`${B.size}em`,m.style.height=`${B.size}em`;const t=e.map((e=>{const t=document.createElement("div");return t.tile=e,t.classList.add("tile",e.icon||""),x(t,e.position),e.subscribe("position",(e=>{x(t,e)})),e.subscribe("icon",(i=>{(e.icon||i)&&(e.icon&&t.classList.remove(e.icon),i&&t.classList.add(i))})),t.addEventListener("click",(e=>async()=>{if(!D)return D=e,e.classList.add("active"),void P.start();if(D.classList.remove("active"),D===e)return void(D=null);let t=0;if(c.areSwappable(D.tile,e.tile)){if(B.swapTiles(D.tile,e.tile),await w.play(),B.hasMatches())do{t++,await h(400),B.resolveMatches(),B.shiftItems(),B.calculateScore(t),P.add(5),await y.play(),v&&(v.innerText=`${t}X`,C.play()),await h(400),B.fillUp()}while(B.hasMatches());else await h(400),await w.play(),B.swapTiles(D.tile,e.tile);P.start()}D=null})(t)),t}));m.replaceChildren(...t)})),B.subscribe("score",(e=>{g&&(g.innerText=`${e}`)})),P.subscribe("time",(e=>{L&&(L.innerText=`${new Date(1e3*e).toISOString().substring(14,19)}`,0!==e||h(1e3).then((()=>{P.reset(),B.generate()})))})),B.generate(),window.board=B,window.timer=P,window.animation=C;
//# sourceMappingURL=index.ecf50c29.js.map
